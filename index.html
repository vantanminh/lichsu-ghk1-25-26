<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ôn Luyện Đề Thi Lịch Sử (Nâng cao)</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; line-height: 1.6; color: #333; background-color: #f4f4f9; margin: 0; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; background-color: #fff; padding: 25px 30px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); }
        h1, h2 { color: #0056b3; border-bottom: 2px solid #e0e0e0; padding-bottom: 10px; }
        .controls { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; margin-bottom: 25px; padding: 15px; background-color: #e7f3ff; border-left: 5px solid #0056b3; border-radius: 5px; }
        .mode-selector label { margin-right: 15px; font-weight: 500; cursor: pointer; }
        .mode-selector input[type="radio"] { margin-right: 5px; }
        .reset-btn { padding: 8px 15px; font-size: 1em; font-weight: bold; color: #fff; background-color: #28a745; border: none; border-radius: 5px; cursor: pointer; transition: background-color 0.3s; }
        .reset-btn:hover { background-color: #218838; }
        .question-block { margin-bottom: 2em; padding-bottom: 1.5em; border-bottom: 1px dashed #ccc; }
        .question-block p { margin-top: 0; font-weight: bold; }
        .q-number { margin-right: 8px; }
        .options label { display: block; margin: 0.5em 0; padding: 10px; border-radius: 5px; border: 1px solid #ddd; cursor: pointer; transition: all 0.2s; }
        .tf-options .options-wrapper { margin-bottom: 10px; }
        .tf-options label { display: inline-block; width: 80px; text-align: center; margin-left: 15px; }
        .options label:hover { background-color: #f0f8ff; border-color: #007bff; }
        .options input[type="radio"] { margin-right: 10px; }
        .submit-btn { display: block; width: 100%; padding: 15px; font-size: 1.2em; font-weight: bold; color: #fff; background-color: #007bff; border: none; border-radius: 5px; cursor: pointer; margin-top: 20px; }
        .submit-btn:hover { background-color: #0056b3; }
        #results { margin-top: 30px; padding: 20px; border-radius: 8px; background-color: #f9f9f9; border: 2px solid #007bff; }
        .hidden { display: none; }
        .option-prefix { font-weight: bold; margin-right: 8px; }
        /* Feedback Styles */
        .final-correct, .show-correct-answer { background-color: #d4edda !important; border-color: #155724 !important; }
        .final-incorrect, .immediate-incorrect { background-color: #f8d7da !important; border-color: #721c24 !important; }
        .immediate-correct { background-color: #d1ecf1 !important; border-color: #0c5460 !important; }
    </style>
</head>
<body>

    <div class="container">
        <h1>Ôn luyện đề thi Lịch sử</h1>
        
        <div class="controls">
            <div class="mode-selector">
                <label><input type="radio" name="mode" value="practice" checked> Luyện tập</label>
                <label><input type="radio" name="mode" value="test"> Thi</label>
            </div>
            <button type="button" class="reset-btn">Làm lại (Xáo trộn)</button>
        </div>

        <form id="quizForm">
            <h2><strong>I. TRẮC NGHIỆM NHIỀU LỰA CHỌN</strong></h2>
            <div id="mc-questions-container">
                <!-- Các câu hỏi trắc nghiệm nhiều lựa chọn sẽ được JS chèn vào đây -->
            </div>

            <h2><strong>II. TRẮC NGHIỆM ĐÚNG – SAI</strong></h2>
            <div id="tf-questions-container">
                <!-- Các câu hỏi Đúng-Sai sẽ được JS chèn vào đây -->
            </div>
            
            <button type="submit" class="submit-btn hidden">Nộp bài</button>
        </form>

        <div id="results" class="hidden">
            <h2>Kết quả bài thi</h2>
            <p id="score-mc"></p>
            <p id="score-tf"></p>
            <p id="total-score" style="font-weight: bold; font-size: 1.2em;"></p>
        </div>
    </div>

    <script>
    const quizData = {
        mc: [
            { q: "“<em>Lật đổ chế độ phong kiến đứng đầu là vua Sác- lơ I...</em>” là mục tiêu của cuộc cách mạng tư sản ở quốc gia nào sau đây?", a: "C", o: { A: "Nga.", B: "Pháp.", C: "Anh.", D: "Bắc Mỹ." } },
            { q: "Ở nước Anh... Nhiều quý tộc chuyển hướng kinh doanh... trở thành tầng lớp", a: "D", o: { A: "tư sản.", B: "chủ nô.", C: "quý tộc phong kiến.", D: "quý tộc mới." } },
            { q: "Đầu thế kỉ XVII, ngành công nghiệp phát triển nhất ở nước Anh là", a: "C", o: { A: "luyện kim.", B: "máy hơi nước.", C: "len dạ.", D: "chế tạo máy móc." } },
            { q: "Đến giữa thế kỉ XVIII, khu vực miền Bắc của 13 bang thuộc địa Anh ở Bắc Mĩ phổ biến phát triển", a: "B", o: { A: "kinh tế đồn điền.", B: "công trường thủ công.", C: "dệt và làm gốm.", D: "phường hội thủ công." } },
            { q: "Khẩu hiệu nổi tiếng của bản Tuyên ngôn Nhân quyền và Dân quyền trong Cách mạng tư sản Pháp năm 1789 là", a: "D", o: { A: "“đề cao quyền tự do của con người”.", B: "“Độc lập – Tự do – Hạnh phúc”.", C: "“bảo vệ quyền lợi của giai cấp tư sản”.", D: "“Tự do – Bình đẳng – Bác ái”." } },
            { q: "Một trong những nhiệm vụ của các cuộc cách mạng tư sản từ giữa thế kỉ XVI đến đầu thế kỉ XX là", a: "A", o: { A: "xóa bỏ chế độ phong kiến chuyên chế.", B: "xóa bỏ triệt để mâu thuẫn trong xã hội.", C: "đưa giai cấp công nhân lên nắm quyền.", D: "xác lập sự thống trị của chủ nghĩa thực dân." } },
            { q: "Động lực quyết định thắng lợi của các cuộc cách mạng tư sản từ giữa thế kỉ XVI đến đầu thế kỉ XX là", a: "B", o: { A: "phương pháp đấu tranh.", B: "quần chúng nhân dân.", C: "kết quả cuối cùng.", D: "mục tiêu cách mạng." } },
            { q: "Nội dung nào sau đây là tiền đề về mặt tư tưởng của cuộc cách mạng tư sản ở nước Pháp thế kỉ XVIII?", a: "A", o: { A: "Triết học Ánh sáng.", B: "Cải cách tôn giáo.", C: "Văn hóa Phục hưng.", D: "Khởi nghĩa nông dân." } },
            { q: "Nội dung nào sau đây <strong>không phải</strong> là mục tiêu của các cuộc cách mạng tư sản thế kỉ XVI - XVIII?", a: "D", o: { A: "Lật đổ chế độ phong kiến, thực dân cùng tàn tích của nó.", B: "Tạo điều kiện cho sự phát triển của kinh tế tư bản chủ nghĩa.", C: "Thiết lập nền thống trị của giai cấp tư sản và liên minh của họ.", D: "Mở ra thời đại thời đại thắng lợi của chế độ xã hội chủ nghĩa." } },
            { q: "Các cuộc cách mạng tư sản thời cận đại đều", a: "A", o: { A: "dẫn đến xác lập quan hệ sản xuất tư bản chủ nghĩa.", B: "tạo ra một nền dân chủ, tự do thực sự, rộng rãi.", C: "lật đổ chế độ phong kiến, thiết lập nền cộng hòa.", D: "lật đổ chế độ thực dân, thiết lập nền cộng hòa." } },
            { q: "Điểm khác biệt về đặc điểm kinh tế nước Anh so với nước Pháp trước khi bùng nổ cách mạng tư sản (thế kỉ XVII-XVIII) là", a: "A", o: { A: "nền nông nghiệp phát triển.", B: "nền công nghiệp phát triển.", C: "ngoại thương phát triển.", D: "nền nông nghiệp lạc hậu." } },
            { q: "Quần chúng nhân dân có vai trò nào sau đây trong các cuộc cách mạng tư sản thời cận đại?", a: "D", o: { A: "Bị giai cấp tư sản lợi dụng, không được hưởng quyền lợi.", B: "Giữ vai trò lãnh đạo, thúc đẩy cách mạng tiến lên.", C: "Giữ vai trò chính trong việc lật đổ giai cấp tư sản.", D: "Giữ vai trò quyết định đến thành công của cách mạng." } },
            { q: "Nội dung nào sau đây là một trong những biểu hiện của quan hệ sản xuất tư bản chủ nghĩa đã xâm nhập vào nông nghiệp ở nước Anh cuối thế kỉ XV đầu thế kỉ XVI?", a: "A", o: { A: "Hiện tượng “Cừu ăn thịt người”.", B: "Công trường thủ công ra đời.", C: "Ngành công nghiệp phát triển.", D: "Ngành dệt len dạ phát triển." } },
            { q: "Đặc điểm nào sau đây phản ánh <strong>không</strong> đúng về tiền đề cách mạng tư sản ở nước Pháp thế kỉ XVIII?", a: "D", o: { A: "Kinh tế công thương nghiệp phát triển mạnh.", B: "Công cụ và phương thức canh tác thô sơ.", C: "Dân cư chủ yếu sống bằng nghề nông.", D: "Quý tộc mới có thế lực về kinh tế và chính trị." } },
            { q: "Giai cấp tư sản Anh chú trọng xuất khẩu tư bản sang các nước thuộc địa hơn là đầu tư sản xuất trong nước vì", a: "A", o: { A: "nguồn nguyên liệu và nhân công giá rẻ.", B: "nhu cầu tiêu thụ trong nước không nhiều.", C: "không có tài nguyên để sản xuất công nghiệp.", D: "năng lực lao động của công nhân ở Anh thấp." } },
            { q: "Điểm tương đồng trong đời sống kinh tế các nước Mỹ, Đức, Anh, Pháp ở nửa cuối thế kỉ XIX là gì?", a: "D", o: { A: "Kinh tế lâm vào khủng hoảng, suy thoái.", B: "Sản xuất công nghiệp trì trệ, sa sút.", C: "Sản xuất nông nghiệp chậm phát triển.", D: "Xuất hiện các tổ chức độc quyền." } },
            { q: "Mục tiêu chung của tất cả các cuộc cách mạng tư sản là", a: "A", o: { A: "tạo điều kiện cho kinh tế tư bản chủ nghĩa phát triển.", B: "giải quyết mâu thuẫn giữa hai giai cấp nông dân và địa chủ.", C: "tạo điều kiện tiến hành cách mạng công nghiệp thành công.", D: "mở đường cho cách mạng khoa học kỹ thuật phát triển." } },
            { q: "Vai trò của tư tưởng “Triết học Ánh sáng” đối với Cách mạng tư sản Pháp (1789) là", a: "C", o: { A: "đưa ra những lý thuyết về xây dựng nhà nước mới.", B: "phê phán giáo lý lạc hậu, những quan điểm lỗi thời.", C: "dọn đường cho các cuộc cách mạng xã hội bùng nổ.", D: "đề xuất tư tưởng mới tiến bộ, thúc đẩy xã hội tiến lên." } },
            { q: "Hình thức tổ chức độc quyền phổ biến ở Đức thế kỉ XIX là", a: "A", o: { A: "Các-ten.", B: "Xanh-đi-ca.", C: "Tơ-rớt.", D: "Công-xoóc-xi-um." } },
            { q: "Nước nào sau đây được mệnh danh là <em>“Đế quốc mà Mặt Trời không bao giờ lặn”</em>?", a: "A", o: { A: "Anh.", B: "Pháp.", C: "Mỹ.", D: "Đức." } },
            { q: "Từ đầu thế kỉ XIX, để đáp ứng nhu cầu ngày càng cao về nguyên liệu và nhân công các nước tư bản phương Tây đã tăng cường", a: "C", o: { A: "hợp tác và mở rộng đầu tư.", B: "thu hút vốn đầu tư bên ngoài.", C: "xâm lược và mở rộng thuộc địa.", D: "đổi mới hình thức kinh doanh." } },
            { q: "Chính sách xâm lược và mở rộng thuộc địa của các nước tư bản nhằm mục đích đáp ứng nhu cầu", a: "D", o: { A: "phát triển khoa học – kĩ thuật.", B: "giải quyết tình trạng thất nghiệp.", C: "thu hút nguồn vốn đầu tư bên ngoài.", D: "về nguyên liệu và nhân công." } },
            { q: "Nội dung nào sau đây là một trong những thách thức mà chủ nghĩa tư bản hiện đại phải đối mặt?", a: "C", o: { A: "Nguồn nhân công ngày càng cạn kiệt.", B: "Giao lưu kinh tế quốc tế ngày càng tăng.", C: "Mâu thuẫn xã hội ngày càng gia tăng.", D: "Sự ra đời các tổ chức liên kết khu vực." } },
            { q: "Nội dung nào sau đây <strong>không</strong> <strong>phải</strong> là thách thức mà chủ nghĩa tư bản hiện đại đang phải đối mặt?", a: "C", o: { A: "Khủng hoảng kinh tế, tài chính.", B: "Sự chênh lệch giàu nghèo.", C: "Tốc độ phát triển kinh tế toàn cầu.", D: "Tệ nạn xã hội, phân biệt chủng tộc." } },
            { q: "Chủ nghĩa đế quốc ra đời từ cuối thế kỉ XIX đầu thế kỉ XX là hệ quả trực tiếp của quá trình", a: "A", o: { A: "xâm lược thuộc địa.", B: "giao lưu buôn bán.", C: "mở rộng thị trường.", D: "hợp tác kinh tế." } },
            { q: "Sự kiện nào sau đây đánh dấu sự mở rộng của chủ nghĩa tư bản ở ngoài châu Âu?", a: "A", o: { A: "Chiến tranh giành độc lập của 13 thuộc địa Anh ở Bắc Mỹ.", B: "Phong trào đấu tranh giành độc lập ở khu vực Mỹ La-tinh.", C: "Cuộc vận động thống nhất nước Đức và I-ta-li-a.", D: "Cải cách nông nô ở Nga và cuộc nội chiến ở Mỹ." } },
            { q: "Đến cuối thế kỉ XIX - đầu thế kỉ XX, Anh được mệnh danh là đế quốc “Mặt Trời không bao giờ lặn” do", a: "C", o: { A: "hệ thống thuộc địa của Anh bị thu hẹp về vùng xích đạo.", B: "phần lớn thuộc địa của Anh tập trung ở vùng xích đạo.", C: "hệ thống thuộc địa của Anh trải rộng ở khắp các châu lục.", D: "nhà nước Anh tập trung vào phát triển năng lượng Mặt Trời." } },
            { q: "Lĩnh vực nào sau đây là một trong những tiềm năng phát triển của chủ nghĩa tư bản hiện đại?", a: "D", o: { A: "Quân sự, văn hóa.", B: "Văn hóa – giáo dục.", C: "Chính trị, ngoại giao.", D: "Khoa học – công nghệ." } },
            { q: "Cuối thế kỉ XIX - đầu thế kỉ XX, ở nhiều nước tư bản, sự tập trung sản xuất và tập trung nguồn vốn lớn đã dẫn đến sự xuất hiện của các", a: "D", o: { A: "thương hội.", B: "phường hội.", C: "công trường thủ công.", D: "tổ chức độc quyền." } },
            { q: "Cuối thế kỉ XIX - đầu thế kỉ XX, các nước tư bản chuyển sang giai đoạn", a: "B", o: { A: "tự do cạnh tranh.", B: "đế quốc chủ nghĩa.", C: "chủ nghĩa tư bản hiện đại.", D: "chủ nghĩa dân tộc cực đoan." } },
        ],
        tf: [
            {
                q: "Đọc đoạn tư liệu về Tuyên ngôn Mỹ (1776) và Pháp (1791)",
                s: [
                    { t: "Bản Tuyên ngôn Nhân quyền và Dân quyền (1791) ở nước Pháp đã khẳng định các quyền cơ bản của công dân.", a: "Đúng" },
                    { t: "Cách mạng tư sản Pháp cuối thế kỷ XVIII đã thực hiện đầy đủ các nhiệm vụ dân tộc và dân chủ của cách mạng tư sản.", a: "Đúng" },
                    { t: "Bản Tuyên ngôn... của nước Pháp (1791) không đề cập đến quyền tư hữu cá nhân...", a: "Sai" },
                    { t: "Các quyền dân tộc cơ bản trong Tuyên ngôn... đã được phát triển... trong Tuyên ngôn độc lập của Việt Nam (1945).", a: "Đúng" }
                ]
            },
            {
                q: "Đọc đoạn tư liệu về \"rào đất cướp ruộng\" ở Anh",
                s: [
                    { t: "Cuối thế kỉ XV – đầu thế kỉ XVI, phương thức sản xuất tư bản chủ nghĩa đã thâm nhập mạnh vào nông nghiệp Anh.", a: "Đúng" },
                    { t: "Nguyên nhân chủ yếu dẫn đến phong trào <em>“rào đất cướp ruộng”</em>... là do sự phát triển... của ngành công nghiệp len dạ.", a: "Đúng" },
                    { t: "Sự phát triển của kinh tế tư bản chủ nghĩa... làm xuất hiện tầng lớp quý tộc mới.", a: "Đúng" },
                    { t: "Phong trào <em>“rào đất cướp ruộng”</em> đã góp phần cải thiện đời sống của nông dân Anh...", a: "Sai" }
                ]
            },
            {
                q: "Đọc đoạn tư liệu của Lênin về chủ nghĩa tư bản",
                s: [
                    { t: "Một trong những đặc điểm của chủ nghĩa tư bản độc quyền là xuất hiện các tổ chức như: cartel, syndicate, trust,…", a: "Đúng" },
                    { t: "Tổ chức độc quyền là sự liên minh kinh tế giữa giai cấp tư sản và chủ nô để thu lợi nhuận cao.", a: "Sai" },
                    { t: "Đoạn tư liệu cho thấy sự hợp nhất tư bản ngân hàng với tư bản tài chính tạo nên <em>“tư bản công nghiệp”.</em>", a: "Sai" },
                    { t: "Chủ nghĩa tư bản độc quyền là giai đoạn các cường quốc tư bản chủ nghĩa bắt đầu xâm lược...", a: "Sai" }
                ]
            },
            {
                q: "Đọc đoạn tư liệu về phong trào \"99 chống lại 1\"",
                s: [
                    { t: "Sự phân hóa giàu nghèo sâu sắc là một trong những thách thức mà nước Mỹ hiện nay phải đối mặt.", a: "Đúng" },
                    { t: "Nguyên nhân sâu xa dẫn đến phong trào <em>“99 chống lại 1”</em> ở nước Mỹ là hệ quả của quá trình phân biệt chủng tộc ở Mỹ.", a: "Sai" },
                    { t: "Đoạn trích phản ánh các mặt tích cực và hạn chế của nước Mỹ...", a: "Sai" },
                    { t: "Phong trào<em> “99 chống lại 1”</em> cho thấy chủ nghĩa tư bản không ngừng tự điều chỉnh để thích nghi.", a: "Sai" }
                ]
            }
        ]
    };


    document.addEventListener('DOMContentLoaded', function() {
        const quizForm = document.getElementById('quizForm');
        const mcContainer = document.getElementById('mc-questions-container');
        const tfContainer = document.getElementById('tf-questions-container');
        const submitBtn = document.querySelector('.submit-btn');
        const resultsDiv = document.getElementById('results');
        const modeRadios = document.querySelectorAll('input[name="mode"]');
        const resetBtn = document.querySelector('.reset-btn');

        let currentMode = 'practice';
        let questionCounter = 1;

        // Fisher-Yates shuffle algorithm
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function createQuiz() {
            mcContainer.innerHTML = '';
            tfContainer.innerHTML = '';
            questionCounter = 1;

            // Shuffle and create MC questions
            const shuffledMC = shuffle([...quizData.mc]);
            shuffledMC.forEach((qData, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question-block';
                questionDiv.dataset.answer = qData.a;
                const questionName = `q${index}`;
                questionDiv.dataset.name = questionName;

                const questionText = document.createElement('p');
                questionText.innerHTML = `<span class="q-number"></span> <span class="q-text">${qData.q}</span>`;
                questionDiv.appendChild(questionText);

                const optionsDiv = document.createElement('div');
                optionsDiv.className = 'options';

                const optionKeys = shuffle(Object.keys(qData.o));
                optionKeys.forEach(key => {
                    const label = document.createElement('label');
                    label.innerHTML = `<input type="radio" name="${questionName}" value="${key}"> <span class="option-prefix"></span> ${qData.o[key]}`;
                    optionsDiv.appendChild(label);
                });

                questionDiv.appendChild(optionsDiv);
                mcContainer.appendChild(questionDiv);
            });

            // Shuffle and create TF questions
            const shuffledTF = shuffle([...quizData.tf]);
            shuffledTF.forEach((qData, qIndex) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question-block tf-options';
                const questionText = document.createElement('p');
                questionText.innerHTML = `<span class="q-number"></span> <span class="q-text">${qData.q}</span>`;
                questionDiv.appendChild(questionText);
                
                qData.s.forEach((statement, sIndex) => {
                    const wrapper = document.createElement('div');
                    wrapper.className = 'options-wrapper';
                    const name = `q${shuffledMC.length + qIndex}_${sIndex}`;
                    wrapper.dataset.name = name;
                    wrapper.dataset.answer = statement.a;
                    
                    const statementText = `<span>${String.fromCharCode(97 + sIndex)}) ${statement.t}</span>`;
                    wrapper.innerHTML = `${statementText}
                        <label><input type="radio" name="${name}" value="Đúng"> Đúng</label>
                        <label><input type="radio" name="${name}" value="Sai"> Sai</label>`;
                    questionDiv.appendChild(wrapper);
                });
                tfContainer.appendChild(questionDiv);
            });

            updateNumbersAndLabels();
        }
        
        function updateNumbersAndLabels() {
            let globalQuestionIndex = 1;
            // Renumber all questions
            document.querySelectorAll('.question-block').forEach(qBlock => {
                qBlock.querySelector('.q-number').textContent = `Câu ${globalQuestionIndex++}:`;
            });
            
            // Relabel MC options
            document.querySelectorAll('#mc-questions-container .options').forEach(optionsDiv => {
                optionsDiv.querySelectorAll('label').forEach((label, index) => {
                    label.querySelector('.option-prefix').textContent = `${String.fromCharCode(65 + index)}.`;
                });
            });
        }
        
        function checkAnswerImmediately(event) {
            if (currentMode !== 'practice') return;
            const selectedInput = event.target;
            const parentWrapper = selectedInput.closest('.question-block, .options-wrapper');
            const correctAnswer = parentWrapper.dataset.answer;
            const userAnswer = selectedInput.value;
            const name = parentWrapper.dataset.name;
            const questionInputs = parentWrapper.querySelectorAll(`input[name="${name}"]`);
            const selectedLabel = selectedInput.parentElement;
            
            if (userAnswer === correctAnswer) {
                selectedLabel.classList.add('immediate-correct');
            } else {
                selectedLabel.classList.add('immediate-incorrect');
            }
            
            // Find and show correct answer
            parentWrapper.querySelectorAll('input').forEach(input => {
                if(input.value === correctAnswer) {
                    input.parentElement.classList.add('show-correct-answer');
                }
            });
            
            questionInputs.forEach(input => input.disabled = true);
        }

        function setupListenersForMode() {
            if (currentMode === 'practice') {
                submitBtn.classList.add('hidden');
                document.querySelectorAll('input[type="radio"]:not([name="mode"])').forEach(input => {
                    input.addEventListener('change', checkAnswerImmediately);
                });
            } else { // Test mode
                submitBtn.classList.remove('hidden');
                // Remove immediate listeners if they exist
                 document.querySelectorAll('input[type="radio"]:not([name="mode"])').forEach(input => {
                    input.removeEventListener('change', checkAnswerImmediately);
                });
            }
        }
        
        function initializeQuiz() {
            quizForm.reset();
            resultsDiv.classList.add('hidden');
            createQuiz();
            setupListenersForMode();
        }

        modeRadios.forEach(radio => {
            radio.addEventListener('change', (event) => {
                currentMode = event.target.value;
                initializeQuiz();
            });
        });
        
        resetBtn.addEventListener('click', initializeQuiz);

        quizForm.addEventListener('submit', function(event) {
            event.preventDefault();
            if (currentMode !== 'test') return;

            let scoreMC = 0;
            let totalMC = quizData.mc.length;
            let scoreTF = 0;
            let totalTF = quizData.tf.reduce((acc, curr) => acc + curr.s.length, 0);

            document.querySelectorAll('#mc-questions-container .question-block').forEach(q => {
                const correctAnswer = q.dataset.answer;
                const userInput = q.querySelector('input:checked');
                if (userInput) {
                    const userLabel = userInput.parentElement;
                    if (userInput.value === correctAnswer) {
                        scoreMC++;
                        userLabel.classList.add('final-correct');
                    } else {
                        userLabel.classList.add('final-incorrect');
                        q.querySelector(`input[value="${correctAnswer}"]`).parentElement.classList.add('final-correct');
                    }
                }
            });

            document.querySelectorAll('#tf-questions-container .options-wrapper').forEach(item => {
                const correctAnswer = item.dataset.answer;
                const userInput = item.querySelector('input:checked');
                if (userInput) {
                    if (userInput.value === correctAnswer) {
                        scoreTF++;
                        userInput.parentElement.classList.add('final-correct');
                    } else {
                        userInput.parentElement.classList.add('final-incorrect');
                    }
                }
            });

            document.getElementById('score-mc').textContent = `Phần I (Nhiều lựa chọn): Đúng ${scoreMC} / ${totalMC} câu.`;
            document.getElementById('score-tf').textContent = `Phần II (Đúng - Sai): Đúng ${scoreTF} / ${totalTF} ý.`;
            document.getElementById('total-score').textContent = `Tổng điểm: ${scoreMC + scoreTF} / ${totalMC + totalTF}`;

            resultsDiv.classList.remove('hidden');
            resultsDiv.scrollIntoView({ behavior: 'smooth' });
        });

        // Initial setup
        initializeQuiz();
    });
    </script>

</body>
</html>
