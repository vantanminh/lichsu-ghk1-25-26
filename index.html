<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ôn Luyện Đề Thi Lịch Sử - Cập nhật mới</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; line-height: 1.6; color: #333; background-color: #f4f4f9; margin: 0; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; background-color: #fff; padding: 25px 30px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); }
        h1, h2 { color: #0056b3; border-bottom: 2px solid #e0e0e0; padding-bottom: 10px; }
        .controls { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; margin-bottom: 25px; padding: 15px; background-color: #e7f3ff; border-left: 5px solid #0056b3; border-radius: 5px; }
        .mode-selector label { margin-right: 15px; font-weight: 500; cursor: pointer; }
        .mode-selector input[type="radio"] { margin-right: 5px; }
        .reset-btn { padding: 8px 15px; font-size: 1em; font-weight: bold; color: #fff; background-color: #28a745; border: none; border-radius: 5px; cursor: pointer; transition: background-color 0.3s; }
        .reset-btn:hover { background-color: #218838; }
        .question-block { margin-bottom: 2em; padding-bottom: 1.5em; border-bottom: 1px dashed #ccc; }
        .question-block p { margin-top: 0; font-weight: bold; }
        .q-number { margin-right: 8px; }
        .options label { display: block; margin: 0.5em 0; padding: 10px; border-radius: 5px; border: 1px solid #ddd; cursor: pointer; transition: all 0.2s; }
        .tf-options .options-wrapper { margin-bottom: 10px; }
        .tf-options label { display: inline-block; width: 80px; text-align: center; margin-left: 15px; }
        .options label:hover { background-color: #f0f8ff; border-color: #007bff; }
        .options input[type="radio"] { margin-right: 10px; }
        .submit-btn { display: block; width: 100%; padding: 15px; font-size: 1.2em; font-weight: bold; color: #fff; background-color: #007bff; border: none; border-radius: 5px; cursor: pointer; margin-top: 20px; }
        .submit-btn:hover { background-color: #0056b3; }
        #results { margin-top: 30px; padding: 20px; border-radius: 8px; background-color: #f9f9f9; border: 2px solid #007bff; }
        .hidden { display: none; }
        .option-prefix { font-weight: bold; margin-right: 8px; }
        /* Feedback Styles */
        .final-correct, .show-correct-answer { background-color: #d4edda !important; border-color: #155724 !important; }
        .final-incorrect, .immediate-incorrect { background-color: #f8d7da !important; border-color: #721c24 !important; }
        .immediate-correct { background-color: #d1ecf1 !important; border-color: #0c5460 !important; }
    </style>
</head>
<body>

    <div class="container">
        <h1>Ôn luyện đề thi Lịch sử</h1>
        
        <div class="controls">
            <div class="mode-selector">
                <label><input type="radio" name="mode" value="practice" checked> Luyện tập</label>
                <label><input type="radio" name="mode" value="test"> Thi</label>
            </div>
            <button type="button" class="reset-btn">Làm lại (Xáo trộn)</button>
        </div>

        <form id="quizForm">
            <div id="part1-container">
                <h2><strong>I. TRẮC NGHIỆM NHIỀU LỰA CHỌN</strong></h2>
                <div id="mc-questions-container">
                    <!-- Các câu hỏi trắc nghiệm nhiều lựa chọn sẽ được JS chèn vào đây -->
                </div>
            </div>

            <div id="part2-container">
                <h2><strong>II. TRẮC NGHIỆM ĐÚNG – SAI</strong></h2>
                <div id="tf-questions-container">
                    <!-- Các câu hỏi Đúng-Sai sẽ được JS chèn vào đây -->
                </div>
            </div>
            
            <button type="submit" class="submit-btn hidden">Nộp bài</button>
        </form>

        <div id="results" class="hidden">
            <h2>Kết quả bài thi</h2>
            <p id="score-mc"></p>
            <p id="score-tf" class="hidden"></p>
            <p id="total-score" style="font-weight: bold; font-size: 1.2em;"></p>
        </div>
    </div>

    <script>
    const quizData = {
        mc: [
            { q: "Sự phát triển của nền kinh tế đã làm biến đổi xã hội Tây Âu và Bắc Mỹ, xuất hiện các giai cấp, tầng lớp mới đại diện cho phương thức sản xuất", a: "A", o: { A: "tư bản chủ nghĩa.", B: "phong kiến.", C: "xã hội chủ nghĩa.", D: "chiếm hữu nô lệ." } },
            { q: "Đến giữa thế kỉ XVIII, miền Bắc của 13 bang thuộc địa Anh ở Bắc Mĩ phổ biến phát triển", a: "B", o: { A: "kinh tế đồn điền.", B: "công trường thủ công.", C: "dệt và làm gốm.", D: "phường hội thủ công." } },
            { q: "Lực lượng nào lãnh đạo của cuộc cách mạng tư sản thế kỉ XVI - XVIII?", a: "A", o: { A: "Giai cấp tư sản.", B: "Giai cấp công nhân.", C: "Giai cấp nông dân.", D: "Giai cấp địa chủ." } },
            { q: "Các cuộc cách mạng tư sản thế kỉ XVI - XVIII có hai nhiệm vụ cơ bản là", a: "A", o: { A: "dân tộc và dân chủ.", B: "dân tộc và dân sinh.", C: "độc lập và tự do.", D: "dân chủ và dân quyền." } },
            { q: "Đẳng cấp 3 trong xã hội Pháp trước cách mạng tư sản (thế kỉ XVIII) gồm những lực lượng nào?", a: "A", o: { A: "Tư sản, nông dân, bình dân thành thị.", B: "Quý tộc, nông dân, tăng lữ, thợ thủ công.", C: "Tăng lữ, quý tộc và tư sản, nông dân.", D: "Vua, quan lại, tăng lữ, bình dân thành thị." } },
            { q: "Đặc điểm nổi bật của tình hình chính trị nước Anh và Pháp trước khi bùng nổ cách mạng tư sản là", a: "A", o: { A: "tồn tại chế độ quân chủ chuyên chế.", B: "là thuộc địa của chủ nghĩa thực dân.", C: "xuất hiện kinh tế tư bản chủ nghĩa.", D: "xuất hiện trào lưu triết học ánh sáng." } },
            { q: "Các cuộc cách mạng tư sản thời cận đại có điểm gì chung?", a: "A", o: { A: "Mở đường cho chủ nghĩa tư bản phát triển.", B: "Tư sản và chủ nô lãnh đạo.", C: "Nhằm mục đích xóa bỏ chế độ nô lệ.", D: "Diễn ra dưới hình thức nội chiến." } },
            { q: "Tính chất của Chiến tranh giành độc lập ở Bắc Mĩ cuối thế kỉ XVIII là cuộc", a: "C", o: { A: "nội chiến đẫm máu.", B: "cách mạng tư sản triệt để.", C: "cách mạng tư sản không triệt để.", D: "chiến tranh giải phóng vô sản." } },
            { q: "Mục tiêu chung của cách cuộc cách mạng tư sản ở thế kỉ XVI- XVIII là gì?", a: "A", o: { A: "Lật đổ chế đổ phong kiến, thực dân cùng tàn tích của nó.", B: "Lật đổ xã hội nguyên thủy, cổ đại cùng tàn tích của nó.", C: "Tạo điều kiện cho sự phát triển của chế độ phong kiến.", D: "Mở đường cho sự phát triển của chủ nghĩa xã hội." } },
            { q: "Mâu thuẫn nào sau đây là một trong những tiền đề của các cách mạng tư sản?", a: "C", o: { A: "Công nhân với địa chủ phong kiến.", B: "Tư sản với tầng lớp quý tộc mới.", C: "Tư sản, quý tộc mới với chế độ phong kiến.", D: "Bình dân thành thị với nhà nước phong kiến." } },
            { q: "Hình bên mô tả biểu hiện nào sau đây khi quan hệ sản xuất tư bản chủ nghĩa đã xâm nhập vào nông nghiệp ở nước Anh cuối thế kỉ XV đầu thế kỉ XVI?", a: "A", o: { A: "Hiện tượng “Cừu ăn thịt người”.", B: "Ngành công nghiệp phát triển.", C: "Ngành dệt len dạ phát triển.", D: "Công trường thủ công ra đời." } },
            { q: "Sự kiện nào ở hình bên đánh dấu Cách mạng tư sản Pháp bùng nổ (14/7/1789)?", a: "B", o: { A: "Quốc hội phế truất vua, thiết lập nền cộng hòa.", B: "Quần chúng nhân dân tấn công ngục Bastilles.", C: "Quân khởi nghĩa tấn công cung điện Versailles.", D: "Hội nghị ba đẳng cấp tại cung điện Versailles." } },
            { q: "Đại hội Xô viết toàn Nga lần thứ hai, khai mạc đêm 25-10-1917 đã ra tuyên bố", a: "A", o: { A: "thành lập chính quyền Xô viết.", B: "thông qua sắc lệnh “Hòa bình”.", C: "thông qua sắc lệnh “Ruộng đất”.", D: "thông qua chính sách “Kinh tế mới”." } },
            { q: "Bốn nước đầu tiên trong Liên bang cộng hòa xã hội chủ nghĩa Xô viết (1922) là", a: "A", o: { A: "Nga, U-crai-na, Bê-lô-rút-xi-a và Ngoại Cáp-ca-dơ.", B: "Nga, Bê-lô-rút-xi-a, Ca-dắc-xtan và Ngoại Cáp-ca-dơ.", C: "Nga, U-crai-na, E-xtô-ni-a và Lít-va.", D: "Nga, U-crai-na, Lít-va, Bê-la-rút-xi-a." } },
            { q: "Sự ra đời của Liên bang Cộng hoà xã hội chủ nghĩa Xô viết có ý nghĩa như thế nào đối với quốc tế?", a: "B", o: { A: "Làm thất bại ý đồ và hành động chia rẽ của các thế lực thù địch.", B: "Tạo tiền đề cho sự ra đời của hệ thống xã hội chủ nghĩa.", C: "Củng cố và tăng cường vị thế của Liên Xô trên trường quốc tế.", D: "Tạo điều kiện để các nước cộng hòa phát triển kinh tế - xã hội." } },
            { q: "Nhằm thủ tiêu những tàn tích của chế độ phong kiến, đem lại các quyền tự do, dân chủ cho nhân dân, ngày 26/10/1917 (theo lịch Nga), Chính quyền Nga Xô viết đã", a: "C", o: { A: "thông qua Chính sách kinh tế mới do Lenin soạn thảo.", B: "phát động cuộc đấu tranh chống thù trong, giặc ngoài.", C: "ban hành Sắc lệnh Hòa bình và Sắc lệnh Ruộng đất.", D: "ban hành Chính sách Cộng sản thời chiến." } },
            { q: "Nguyên nhân quyết định dẫn đến thắng lợi của các nước Cộng hòa xã hội chủ nghĩa trên đất nước Xô viết trong cuộc chiến chống thù trong, giặc ngoài là", a: "A", o: { A: "sự đoàn kết, giúp đỡ nhau.", B: "sự ủng hộ từ bên ngoài.", C: "có sức mạnh về ngoại giao.", D: "có sự ủng hộ của Mỹ." } },
            { q: "Sau Cách mạng tháng Mười Nga (1917), nhiệm vụ hàng đầu của chính quyền Xô viết là", a: "A", o: { A: "đập tan bộ máy nhà nước cũ, xây dựng bộ máy nhà nước mới.", B: "hàn gắn vết thương chiến tranh, khôi phục và phát triển kinh tế.", C: "khôi phục và phát triển kinh tế, chống lại thù trong giặc ngoài.", D: "tiến hành công nghiệp hóa, hiện đại hóa tiến lên chủ nghĩa xã hội." } },
            { q: "Đối với Liên Xô, sự ra đời của Liên bang Cộng hoà xã hội chủ nghĩa Xô viết <strong>không</strong> có ý nghĩa nào sau đây?", a: "D", o: { A: "Thể hiện sức mạnh đoàn kết, giúp đỡ nhau giữa các dân tộc Xô viết.", B: "Phù hợp với lợi ích chung của các dân tộc trên đất nước Xô viết.", C: "Tăng cường vị thế của Nhà nước Liên Xô trên trường quốc tế.", D: "Tạo tiền đề cho sự ra đời của hệ thống xã hội chủ nghĩa trên thế giới." } },
            { q: "Tháng 01/1924, bản Hiến pháp đầu tiên của Liên Xô được thông qua, hoàn thành quá trình thành lập", a: "D", o: { A: "nhà nước dân chủ tư sản kiểu mới đầu tiên trên thế giới.", B: "chính Đảng vô sản đầu tiên, đấu tranh cho quyền lợi của mọi giai cấp.", C: "nhà nước tư bản hiện đại đầu tiên trên thế giới.", D: "nhà nước Liên bang Cộng hoà xã hội chủ nghĩa đầu tiên trên thế giới." } },
            { q: "Hiến pháp Liên Xô (1924) ghi nhận việc hợp tác giữa các nước Xô viết thành một nhà nước Liên bang dựa trên cơ sở", a: "C", o: { A: "đồng thuận về văn hóa.", B: "hợp nhất các lực lượng.", C: "tự nguyện của các quốc gia.", D: "tự nguyện có điều kiện." } },
            { q: "Liên Xô được xem là chỗ dựa vững chắc của phong trào cách mạng và hòa bình thế giới vì", a: "A", o: { A: "chính phủ Liên Xô có nhiều chính sách đối ngoại hòa bình và tích cực ủng hộ phong trào giải phóng dân tộc trên thế giới.", B: "Liên Xô đạt được thế cân bằng chiến lược về sức mạnh quân sự nói chung và sức mạnh hạt nhân nói riêng so với Mĩ.", C: "Liên Xô là cường quốc công nghiệp đứng hàng thứ hai trên thế giới (chỉ sau Mĩ).", D: "Liên Xô là nước dẫn đầu thế giới về những chuyến bay dài ngày trong vũ trụ." } },
            { q: "Một trong những nguyên nhân giúp nhiều nước Đông Âu đạt được nhiều thành tựu kinh tế - xã hội giai đoạn 1950 - 1970 là nhờ", a: "A", o: { A: "sự giúp đỡ của Liên Xô.", B: "diễn ra cuộc cách mạng tư sản.", C: "có trình độ khoa học - kĩ thuật đi đầu.", D: "đất nước hòa bình, không có sự chống phá." } },
            { q: "Từ năm 1991, nước Cộng hòa Cu-ba đã phải đối mặt với nhiều khó khăn thách thức, đặc biệt là", a: "D", o: { A: "sự chống phá của các thế lực thù địch trong nước.", B: "chính quyền độc tài thân Mĩ chưa bị lật đổ.", C: "con đường xã hội chủ nghĩa chưa có tính ưu việt.", D: "lệnh cấm vận kéo dài của Mỹ và phương Tây." } },
            { q: "Năm 2003, Trung Quốc đạt được thành tựu khoa học kỹ thuật nào sau đây?", a: "C", o: { A: "Phóng thành công vệ tinh nhân tạo.", B: "Thử thành công bom nguyên tử.", C: "Phóng tàu vũ trụ Thần Châu V.", D: "Phóng tàu thăm dò Mặt Trăng." } },
            { q: "Một trong những đặc khu kinh tế đầu tiên của Trung Quốc được xây dựng trong thời kỳ cải cách mở cửa là", a: "D", o: { A: "Hàng Châu.", B: "Thành Đô.", C: "Quảng Châu.", D: "Thâm Quyến." } },
            { q: "Từ cuối thế kỷ XX, vị thế của Trung Quốc không ngừng được nâng cao trên trường quốc tế là do", a: "A", o: { A: "sự điều chỉnh chính sách đối ngoại và bình thường hóa quan hệ với nhiều nước.", B: "sở hữu nhiều vũ khí hạt nhân và công nghệ quốc phòng nhiều nhất trên thế giới.", C: "ra sức thực hiện “giấc mơ Trung Hoa”, âm mưu làm bá chủ trên toàn thế giới.", D: "thường xuyên gây ra nhiều cuộc chiến tranh xâm và nô dịch các nước láng giềng." } },
            { q: "Năm 2010, quốc gia nào sau đây có nền kinh tế đứng thứ hai thế giới?", a: "D", o: { A: "Liên Xô.", B: "Nhật Bản.", C: "Việt Nam.", D: "Trung Quốc." } },
            { q: "Sau Chiến tranh thế giới thứ hai, chủ nghĩa xã hội từ phạm vi một nước đã", a: "B", o: { A: "trở thành siêu cường số một thế giới.", B: "trở thành một hệ thống trên thế giới.", C: "bị xoá bỏ hoàn toàn trên thế giới.", D: "lan rộng sang các nước ở Tây Âu." } },
            { q: "Từ năm 1978 đến nay, nền kinh tế của Trung Quốc đã đạt được thành tựu nổi bật là", a: "A", o: { A: "tốc độ tăng trưởng trung bình hằng năm cao nhất thế giới.", B: "trở thành trung tâm kinh tế - tài chính của cả thế giới.", C: "vượt sự phát triển của Nhật Bản, luôn đứng đầu châu Á.", D: "trở thành quốc gia nắm giữ chuỗi cung ứng toàn cầu." } },
            { q: "Sự kiện nào đánh dấu chủ nghĩa xã hội đã vượt ra khỏi phạm vi một nước (Liên Xô) và bước đầu trở thành hệ thống thế giới?", a: "A", o: { A: "Sự ra đời các nước dân chủ nhân dân Đông Âu.", B: "Sự ra đời nước Cộng hòa Nhân dân Trung Hoa.", C: "Sự ra đời của nước Cộng hòa Ấn Độ.", D: "Sự ra đời nước Cộng hòa Cuba." } },
            { q: "Năm 1991, sự kiện nào dưới đây có tác động lớn tới hệ thống XHCN?", a: "A", o: { A: "CNXH sụp đổ ở Liên Xô.", B: "CNXH bắt đầu lâm vào khủng hoảng.", C: "Việt Nam tiến hành đường lối đổi mới", D: "Trung Quốc tiến hành cải cách." } }
        ],
        tf: [] // Không có dữ liệu Đúng/Sai trong đề mới
    };

    document.addEventListener('DOMContentLoaded', function() {
        const quizForm = document.getElementById('quizForm');
        const mcContainer = document.getElementById('mc-questions-container');
        const tfContainer = document.getElementById('tf-questions-container');
        const part2Container = document.getElementById('part2-container');
        const submitBtn = document.querySelector('.submit-btn');
        const resultsDiv = document.getElementById('results');
        const modeRadios = document.querySelectorAll('input[name="mode"]');
        const resetBtn = document.querySelector('.reset-btn');

        let currentMode = 'practice';

        // Ẩn phần 2 nếu không có dữ liệu
        if (quizData.tf.length === 0) {
            part2Container.style.display = 'none';
        }

        // Fisher-Yates shuffle algorithm
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function createQuiz() {
            mcContainer.innerHTML = '';
            tfContainer.innerHTML = '';

            // Shuffle and create MC questions
            const shuffledMC = shuffle([...quizData.mc]);
            shuffledMC.forEach((qData, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question-block';
                questionDiv.dataset.answer = qData.a;
                const questionName = `q${index}`;
                questionDiv.dataset.name = questionName;

                const questionText = document.createElement('p');
                questionText.innerHTML = `<span class="q-number"></span> <span class="q-text">${qData.q}</span>`;
                questionDiv.appendChild(questionText);

                const optionsDiv = document.createElement('div');
                optionsDiv.className = 'options';

                const optionKeys = shuffle(Object.keys(qData.o));
                optionKeys.forEach(key => {
                    const label = document.createElement('label');
                    label.innerHTML = `<input type="radio" name="${questionName}" value="${key}"> <span class="option-prefix"></span> ${qData.o[key]}`;
                    optionsDiv.appendChild(label);
                });

                questionDiv.appendChild(optionsDiv);
                mcContainer.appendChild(questionDiv);
            });

            // Shuffle and create TF questions (Nếu có)
            if (quizData.tf.length > 0) {
                const shuffledTF = shuffle([...quizData.tf]);
                shuffledTF.forEach((qData, qIndex) => {
                    const questionDiv = document.createElement('div');
                    questionDiv.className = 'question-block tf-options';
                    const questionText = document.createElement('p');
                    questionText.innerHTML = `<span class="q-number"></span> <span class="q-text">${qData.q}</span>`;
                    questionDiv.appendChild(questionText);
                    
                    qData.s.forEach((statement, sIndex) => {
                        const wrapper = document.createElement('div');
                        wrapper.className = 'options-wrapper';
                        const name = `q${shuffledMC.length + qIndex}_${sIndex}`;
                        wrapper.dataset.name = name;
                        wrapper.dataset.answer = statement.a;
                        
                        const statementText = `<span>${String.fromCharCode(97 + sIndex)}) ${statement.t}</span>`;
                        wrapper.innerHTML = `${statementText}
                            <label><input type="radio" name="${name}" value="Đúng"> Đúng</label>
                            <label><input type="radio" name="${name}" value="Sai"> Sai</label>`;
                        questionDiv.appendChild(wrapper);
                    });
                    tfContainer.appendChild(questionDiv);
                });
            }

            updateNumbersAndLabels();
        }
        
        function updateNumbersAndLabels() {
            let globalQuestionIndex = 1;
            // Renumber all questions
            document.querySelectorAll('.question-block').forEach(qBlock => {
                qBlock.querySelector('.q-number').textContent = `Câu ${globalQuestionIndex++}:`;
            });
            
            // Relabel MC options
            document.querySelectorAll('#mc-questions-container .options').forEach(optionsDiv => {
                optionsDiv.querySelectorAll('label').forEach((label, index) => {
                    label.querySelector('.option-prefix').textContent = `${String.fromCharCode(65 + index)}.`;
                });
            });
        }
        
        function checkAnswerImmediately(event) {
            if (currentMode !== 'practice') return;
            const selectedInput = event.target;
            const parentWrapper = selectedInput.closest('.question-block, .options-wrapper');
            const correctAnswer = parentWrapper.dataset.answer;
            const userAnswer = selectedInput.value;
            const name = parentWrapper.dataset.name;
            const questionInputs = parentWrapper.querySelectorAll(`input[name="${name}"]`);
            const selectedLabel = selectedInput.parentElement;
            
            if (userAnswer === correctAnswer) {
                selectedLabel.classList.add('immediate-correct');
            } else {
                selectedLabel.classList.add('immediate-incorrect');
            }
            
            // Find and show correct answer
            parentWrapper.querySelectorAll('input').forEach(input => {
                if(input.value === correctAnswer) {
                    input.parentElement.classList.add('show-correct-answer');
                }
            });
            
            questionInputs.forEach(input => input.disabled = true);
        }

        function setupListenersForMode() {
            if (currentMode === 'practice') {
                submitBtn.classList.add('hidden');
                document.querySelectorAll('input[type="radio"]:not([name="mode"])').forEach(input => {
                    input.addEventListener('change', checkAnswerImmediately);
                });
            } else { // Test mode
                submitBtn.classList.remove('hidden');
                // Remove immediate listeners
                 document.querySelectorAll('input[type="radio"]:not([name="mode"])').forEach(input => {
                    input.removeEventListener('change', checkAnswerImmediately);
                });
            }
        }
        
        function initializeQuiz() {
            quizForm.reset();
            resultsDiv.classList.add('hidden');
            createQuiz();
            setupListenersForMode();
        }

        modeRadios.forEach(radio => {
            radio.addEventListener('change', (event) => {
                currentMode = event.target.value;
                initializeQuiz();
            });
        });
        
        resetBtn.addEventListener('click', initializeQuiz);

        quizForm.addEventListener('submit', function(event) {
            event.preventDefault();
            if (currentMode !== 'test') return;

            let scoreMC = 0;
            let totalMC = quizData.mc.length;
            let scoreTF = 0;
            let totalTF = quizData.tf.reduce((acc, curr) => acc + curr.s.length, 0);

            // Check MC
            document.querySelectorAll('#mc-questions-container .question-block').forEach(q => {
                const correctAnswer = q.dataset.answer;
                const userInput = q.querySelector('input:checked');
                if (userInput) {
                    const userLabel = userInput.parentElement;
                    if (userInput.value === correctAnswer) {
                        scoreMC++;
                        userLabel.classList.add('final-correct');
                    } else {
                        userLabel.classList.add('final-incorrect');
                        q.querySelector(`input[value="${correctAnswer}"]`).parentElement.classList.add('final-correct');
                    }
                }
            });

            // Check TF
            document.querySelectorAll('#tf-questions-container .options-wrapper').forEach(item => {
                const correctAnswer = item.dataset.answer;
                const userInput = item.querySelector('input:checked');
                if (userInput) {
                    if (userInput.value === correctAnswer) {
                        scoreTF++;
                        userInput.parentElement.classList.add('final-correct');
                    } else {
                        userInput.parentElement.classList.add('final-incorrect');
                    }
                }
            });

            document.getElementById('score-mc').textContent = `Phần I (Nhiều lựa chọn): Đúng ${scoreMC} / ${totalMC} câu.`;
            
            const tfResult = document.getElementById('score-tf');
            if(totalTF > 0) {
                tfResult.textContent = `Phần II (Đúng - Sai): Đúng ${scoreTF} / ${totalTF} ý.`;
                tfResult.classList.remove('hidden');
                document.getElementById('total-score').textContent = `Tổng điểm: ${scoreMC + scoreTF} / ${totalMC + totalTF}`;
            } else {
                 tfResult.classList.add('hidden');
                 document.getElementById('total-score').textContent = `Tổng điểm: ${scoreMC} / ${totalMC}`;
            }

            resultsDiv.classList.remove('hidden');
            resultsDiv.scrollIntoView({ behavior: 'smooth' });
        });

        // Initial setup
        initializeQuiz();
    });
    </script>

</body>
</html>
